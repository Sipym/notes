# 可编程逻辑器件和FPGA设计
## 可编程逻辑器件PLD
![img](img/PLD结构框图.png '图1 PLD结构框图 :size=80%')  
**功能**: 可根据需要进行编程以构成不同功能的逻辑电路  
![img](img/PLD中常用基本符号表示.png '图2 PLD中常用基本符号表示 :size=100%')  

**PLD分类**:   
   - *简单PLD*: 指逻辑们数在500门以下，包括`PROM`、`PLA`、`PAL`、`GAL`等器件  
      - > 通常用于实现规模较小的数字电路
   - *复杂PLD*: 指芯片集成度,逻辑门数500门以上，包括`EPLD`、<font color=purple>GPLD</font>、<font color=purple>FPGA</font>等期间  

### PROM结构
![img](img/PROM结构示意图.png '图3 PROM结构示意图 :size=100%')  
**可编程只读存储器(Programmable Read Only Memory,PROM)**: 一种`与阵列固定`、`或阵列可编程`的简单PLD  
**功能**: 任何逻辑函数转换为<font color=red>标准与-或表达式</font>后，均可以用PROM表示  

### PLA结构
![img](img/PLA结构示意图.png '图4 PLA结构示意图 :size=100%')  
**可编程逻辑阵列(Programmable Logic Array,PLA)**: 是`与阵列可编程`，`或阵列可编程`的逻辑阵列  
**功能**: 将逻辑函数化简为<font color=blue>最简与-或表达式</font>既可以用PLA表示  

### PAL结构
![img](img/PAL结构示意图.png '图5 PAL结构示意图 :size=100%')  
**可编程阵列逻辑(Programmable Array Logic,PAL)**: 是`与阵列可编程`，`或阵列固定`的逻辑阵列  

### GAL结构
**通用阵列逻辑(Genetic Array Logic, GAL)**: 输出结构可以有用户定义的可编程输出结构  

### GPLD结构(复杂PLD)
**复杂可编程逻辑器件(Complex Programmable Logic Device, GPLD)**
**组成**: 多个`逻辑阵列块(Logic Array Block,LAB)`、`I/O控制块`和`可编程互连阵列(PIA)`  
   - `LAB`: 由4~20个`宏单元`组成,每个宏单元有多种配置方式，也可级联使用  
   - `I/O控制块`: 用于<font color=purple>和芯片的输入/输出引脚相连</font>  
   - `可编程互连阵列`: <font color=purple>连接所有宏单元</font>，并通过专用连线与芯片的时钟、复位和使能等引脚相连  

**宏单元**: GPLD的基本结构,相当于一个类似PAL的电路模块，用于实现基本的逻辑功能  
**宏单元组成**: 可编程逻辑阵列，乘积项选择矩阵，可编程寄存器(通过编程实现触发器)  


## 存储器阵列
![img](img/存储器阵列示意图.png '图6 存储器阵列示意图 :size=100%')  
**构成**: 每行为一个存储单元(存储元)，存储一个字。阵列的宽度就是数据的位数  
**容量**: $2^n\text{字} \times m\text{位}$,可简写为$2^n\times m$  
**分类**: 随机存取存储器(Random Access Memory,`RAM`),只读存储器(Read Only Memory,`ROM`)  

### 静态RAM存储元件
![img](img/SRAM6管静态存储元件.png '图7 SRAM 6管静态存储元件 :size=100%')  

**结构组成**: $T_1,T_2$构成触发器,$T_5,T_6$是触发器的负载管,$T_3,T_4$为门控管  

**"0"状态定义**: $T_1$导通,$T_2$截止,此时A为低电平，B位高电平  
**"1"状态定义**: $T_2$导通,$T_1$截止,此时B为低电平，A位高电平  

**<font color=red>写操作</font>**: 字选择线W加高电平 **=>** $T_3,T_4$导通  
   - `写"1"`: 位线$D_0,D_1$分别加高、低电平 **=>** 使得T_2导通,T_1截止  
   - `写"0"`: 位线$D_0,D_1$分别加低、高电平 **=>** 使得T_1导通,T_2截止  

**保持不变**: 字选择线W加低电平,$T_3,T_4$截止,触发器与外界隔离  

**<font color=red>读操作</font>**: 先在两个位线上加高电平, 再字选择线W加上高电平  
   - `读取结果判断`: 根据哪条位线上有负脉冲可区分读出的是"0"还是"1"  
   - `读"1"`: 一开始T_2导通,T_1截止.位线加高电平后,$D_1,T_4,T_2,GND$之间有电流通过，及产生了一个负脉冲  
   - `读"0"`: 一开始T_1导通,T_2截止.位线加高电平后,$D_0,T_3,T_1,GND$之间有电流通过，及产生了一个负脉冲  

**优点**: <font color=red>无须刷新，读后再生</font>。读写速度快  
**缺点**: MOS管多，占硅片面积大.因而价格高、功耗大、集成度低  
> **功耗大**: 当存储元件不工作时，也有电流流过,所以功耗大  

### 动态RAM存储元件
![img](img/DRAM-单管动态存储原价.png '图8 DRAM-单管动态存储元件. :size=100%')  
**写"1"**: 在数据线上加高电平,经T对$C_s$充电  
**写"0"**: 在数据线上加低电平,$C_s$充分放电使其上无电荷  
**读"1"**: 读取时,$C_s$上电荷放电  
**读"0"**: 读取时,$C_s$上无电荷,即没有电流产生  

> :bulb:<font color=purple>动态RAM读操作是破坏性读出，读后应有重写操作</font>,称为**再生**  

> :bulb: <font color=purple>电容上存储的电荷会缓缓放电，超过一定时间，就会丢失信息</font>，因此必须定是给电容充电，称为**再生**

**优点**: MOS管小，占硅片面积小，因而价格便宜、功耗小、集成度高  
**缺点**: 必须定时刷新和读后再生，读写速度相对较慢  


### ROM
**类别**: MROM,PROM,EPROM,EEPROM(E2PROM)等类型  
   - `掩膜制度存储器(MROM)`: 存储的信息由厂家在掩膜工艺过程中写入，用户不能修改  
   - `可编程只读存储器(PROM)`: 用户可用专门的PROM写入器将信息写入，写入不可逆  
   - `可擦除可编程只读存储器(EPROM)`: 允许通过某种编辑器向ROM芯片中写入信息，并可擦除所有信息后重新写入，可反复擦除-写入多次  
   - `电擦除电改写制度存储器(EEPROM)`: 读数据同EPROM,可以用电来擦除和重新编程，<font color=red>可以选择只删除个别字</font>,市面上的U盘即是用的EEPROM作为存储截止  

## FPGA设计概述
**现场可编程门阵列(Field Programmable Gate Array,FPGA)**: 可通过软件对其进行配置和编程，并可反复擦写  
**FPGA技术实现**: 都是基于`查找表(Look-Up Table,LUT)`技术构建的  
**FPGA使用流程**: 设计者通过`逻辑电路图`或`硬件描述语言(HDL)`描述逻辑电路后，<font color=purple>EDA工具</font>自动将逻辑电路<font color=purple>转换为真值表</font>，通过对FPGA器件的编程，将真值表的结果加载到用作LUT的SRAM单元中  
**<font color=purple>组成</font>**: 包含大量的逻辑单元,每个逻辑单元有若干查找表，多路选择器，进位链，触发器等附加逻辑组成  
![img](img/最简单的FPGA逻辑单元结构示意图.png '图9 最简单的FPGA逻辑单元结构示意图 :size=100%')  

### 查找表(LUT)
**组成**: 本质是一个RAM,大部分采用SRAM实现  
**功能**: 可以实现任何逻辑功能,通常用于<font color=purple>实现一个小规模的逻辑函数</font>  
**原理**: 根据要实现的逻辑函数的真值表,将输出值存到LUT(即RAM)中,根据输入A,B,C,...即可对应相应的输出值，这就实现了逻辑函数  
![img](img/四输入LUT结构.png '图10 四输入LUT结构 :size=100%')  


## 专用集成电路
**专用集成电路(Application-Specific Integrated Circuit,ASIC)**: 应特定用户要求和特定电子系统的需要而设计、制造的集成电路  
**分类**:  
   - `全定制`: 需要设计者完成所有电路的设计  
   - `半定制`: 使用标准库里的标准逻辑单元进行设计  


# HDL概述
硬件描述语言是一种用形式化方法来描述数字电路和设计逻辑系统的语言  

## VHDL和Verilog HDL介绍
**共同特点**: 
   - 能形式化地抽象表示电路的结构和行为;  
   - 支持逻辑设计中层次和领域的描述;  
   - 可借用高级语言的精巧结构来简化电路行为的描述,具有电路仿真与验证机制以保证设计的正确性;  
   - 支持电路描述从高曾到低层的综合转换;  
   - 硬件描述与实现工艺无关;便于文档管理;  

**Verilog HDL**: (推荐)  
   - `优点`: 门级开关电路描述方面比VHDL強得多,易于学习和掌握  

**VHDL**:   
   - `优点`: 系统级抽象方面更好  

## 基于HDL的数字电路设计流程
### 第一步 HDL编码
根据目标电路的设计需求进行编码  

### 第二步 仿真
**方式1**: 利用`测试激励`(对待测试模块提供输入的模块)  
**方式2**: 利用c语言程序  

### 第三步 综合
**综合**: 将HDL代码的描述 转换成 一种更接近电路的低层描述(即<font color=purple>网表</font>)  
**网表**: 描述了电路需要由`哪些标准单元` `如何连接`而成  

**综合的大致过程**:  
   1. *代码解析*: `根据语言规范`对HDL进行解析，并生成类似高级语言编译器的抽象语法树，包含了HDL代码中的<font color=blue>层次结构信息</font>  
   2. *多级综合*: 将解析到层次结构信息<font color=purple>转换为电路描述</font>  
   3. *工艺映射*: 将电路描述进一步转换为**<font color=purple>特定工艺</font>**的`标准单元`,输出网表  

### 第四步 物理设计
1. 布局: 确定每个标准单元在三维空间中的位置  
2. 布线: 根据网表描述的标准单元之间的连接关系，在三维空间中通过物理走线将相应的标准单元连接  
3. 静态时序分析: 延时最长的路径称为关键路径，可以根据关键路径的信息对电路设计进行迭代优化  
4. 电路和规则检查  
5. 生成物理设计结果  

### 第五步 投片生产或FPGA验证
**对于ASIC**: 将`版图文件`交付给晶元厂商后，厂商根据版图文件来生成相应的电路芯片  
**对于FPGA**: 将`比特流文件`下载到FPGA文件后，就可以将FPGA配置成目标电路的逻辑，可以在FPGA上开展系统级的验证工作  




