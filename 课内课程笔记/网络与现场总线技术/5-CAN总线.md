# 第五章 CAN总线
## 5.1 CAN总线工作原理
当CAN总线上的一个节点(站)发送数据时，它以报文形式<font color=purple>广播</font>给网络中的<font color=purple>所有节点</font>。  
每组报文开头的11位字符为标识符，<font color=purple>定义了报文的优先级</font>  


## 5.2 CAN的技术规范
### 分层结构
1,2层: 物理层，数据链路层  

---

### 报文的传送及其帧结构(重点）
:star:**报文传送有4种不同类型的帧表示和控制**:  
- >`数据帧`: 携带数据由`发送器`至`接收器`  
- >`远程帧`: 通过`总线单元`发送,以请求发送<font color=green>具有相同标识符</font>的数据帧  
- >`出错帧`: 由<font color=green>检测出总线错误</font>的`任何单元`发送  
- >`超载帧`: 提供`当前`的和`后续`的数据帧的<font color=green>附加延迟</font>  

**帧格式**:  
- >`标准帧`: 11位标识符  
- >`扩展帧`: 29位标识符  

## 5.3 CAN总线的节点组成
:star:**组成**: `51微处理器`，`CAN控制器`，`CAN收发器`，`计数器`组成  

![img](img/CAN总线的节点模块装置.png '图1 CAN总线的节点模块装置 :size=60%')  


### 5.3.1 CAN总线 控制器件SJA1000
**SJA1000的特性**:  
- > `标准格式`和`扩展格式`信息的接收和发送  
- > 具有`64字节`长度的`接收队列`  
- > 在标准格式和扩展格式中都有单/双接收过滤器(含屏蔽和代码寄存器)  
- > 具有读/写访问的错误计数器，能够进行可编程的错误限制报警，并且具有最近一次的误码寄存器  
- > 能够对`每个`CAN总线错误产生`错误中断`  
- > 有功能位定义的仲裁丢失终端功能  
- > 具有一次性发送功能(当错误或仲裁丢失时不重发)  
- > 具有只听模式功能  
- > 支持热插拔  
- > 硬件禁止CLKOUT输出  

**SJA1000的地址组成**:  
- >`控制段`: 存在两种模式`复位模式`，`工作模式`  
- >`发送信息缓冲区`: 发送的信息先写入发送缓冲区  
- >`接收信息缓冲区`:   

---
### 5.3.2 CAN总线收发器-PCA82C50
**主要特性**:  
- > 符合ISO11898标准，<font color=purple>最高速率为$1Mb/s$</font>  
- > 抗汽车环境瞬间干扰，具有<font color=purple>保护总线</font>的能力  
- > 斜率控制，降低射频干扰(RFI)  
- > 有<font color=purple>热保护</font>以及<font color=purple>电源和地短路保护</font>  
- > 有低电流待机模式  
- > 未上电的节点对总线无影响  
- > 可连接<font color=purple>110个节点</font>  
- > 工作<font color=purple>温度$-40$ ~ $+125$</font>摄氏度  


