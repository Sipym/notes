# 第二章 现场总线通信基础

## 2.1 总线的相关概念(<font color=red>考相关概念</font>)
### 2.1.1 基本术语
**总线**: 多个系统功能部件之间传输信号或信息的<font color=green>公共路径</font>  

**总线段**: <u>通过总线</u>相互连接在一起的一组设备  

**总线主设备**: 在总线上<font color=purple><u>发起信息传输</u></font>的设备  

**总线从设备**: <u>只负责接收</u>查询的设备  

**总线的控制信号类型**:  
- >(1) `控制设备的动作与状态`: 如设备清零，启动停止等  
- >(2) `改变总线的操作方式`: 如选择数据字段等  
- >(3) `表明地址和数据的含义`  

**总线协议**: 管理主、从设备工作的一套规则.  

### 2.1.2 总线操作的基本内容
:star:**<font color=red>寻址(最重要的)</font>**:   
- >`物理寻址`(用于现场总线): 选择`某一总线段`上`某一特定位置`的从设备作为响应者  
- >`逻辑寻址`(用于系统总线): 指定存储单元的某一通用区，通用区上某一设备监测到总线上的地址信号并发现与其逻辑地址相符时，则会成为响应者(<font color=green>传递给一个区域，区域内从设备自己比较是否符合</font>)  
- >`广播寻址`(用于现场总线): 选择多个响应者  


**一次总线操作**: 指总线上主设备与从设备之间完成`建立连接`、`数据传送`、`接收`到`脱开`这一操作流程  

**通信请求**: 由总线上某一设备向另一设备发出的传输数据或完成某种动作的请求信号,<font color=green>要求后者给予响应并进行某种服务</font>  

**总线仲裁**: 在同时出现多台设备申请总线使用权时，裁决哪台主设备是下一个占用总线的设备  



**数据传送**: 主从设备建立通信后，进行的数据的读/写操作  

---
(不重要)出错检测及容错: 系统的设计、安装、调试时采取必要的抗干扰措施;总线中设有出错码产生和校验机构  

(不重要)总线定时: 用于指明总线上的`数据和地址`<font color=red>何时有效</font>  


## 2.2 通信系统的组成(<font color=red>重点</font>)
:star:**组成部分**: `信源`、`发送设备`、`信道`、`接受设备`及`信宿`组成  
- > `信源`: 将各种`消息`转换成`原始电信号`  
- > `发送设备`: 将信源产生的信号变换成`适合在信道传输的信号`  
- > `信道`: 信号传递所经的传输介质  
- > `接受设备`: 对信息进行解耦、译码和解码等  

![img](img/通信系统的组成.png '通信系统的组成 :size=70%')  


## 2.3 数据通信基础
### 2.3.1 数据通信的基本概念
**数据传输率**: 单位时间内传送的数据量  
- >:star:`比特率S`: 数字信号的传输数率，表示单位时间内所传送的二进制代码的有效位数,$b/s$  
- >:star:`波特率B`: 调制速率，单位时间内载波调制状态改变次数来表示，单位为波特($Baud$),或者是<font color=green>数据传输过程中每秒传送的波形个数</font> 
- > :star:<font color=red>$S = B \times \log_2N$</font>  
   - >$N$: 有效状态数，如1位二进制码，则$N=2$,2位，则$N=4$  

:star:**<font color=red>误码率</font>**: 二进制符号在传输系统中被传错的概率,<font color=red>要求低于$10^{-6}$</font>  

---
<font size=6>了解就行</font>:  
数据、消息与信号:  
- >`数据`: 对客观事实进行描述和记载的物理符号,单独的数据并没有实际含义  
- >`消息`: 可以表达数据本身所具有的含义和解释  
- >`信号`: 数据的电磁或电气的表现，数据以信号的形式在介质中传播  

码元与比特:  
- >`码元`: 信号传输时，<font color=green>一个波形称为一个码元</font>  
- >`比特`: 二进制数的一位  



带宽: 信道允许传送信号的<font color=green>最高频率和最低频率之差</font>  


信道容量: 传输介质能传输信息的最大能力，单位为$b/s$  

---
### 2.3.2 数据传输技术(<font color=red>重点</font>)
#### 1.传输方式(<font color=red>知道哪几种类型</font>)
**串行传输**: 数据的`不同位`<font color=green>分时</font>使用`同一条`传输线  
- >`优点`: 适合多位数据的长距离通信  

**并行传输**: 一个数据的<font color=green>所有位被同时传送</font>  
- >`优点`: 传输速率快  


> :bulb:串行通信<font color=purple>按时钟</font>可分为`异步传输`，`同步传输`  

**异步传输**: 信息以字符为单位进行传输，每个信息字符有`起始位`，`停止位`。每个字符中的各个位是同步的，但相邻两个字符传输数据之间的停顿时间是不确定的(<font color=green>即单一字符的传输时序相同，但传送时机不确定</font>)  
![img](img/串行异步传输数据格式.png '图1 串行异步传输数据格式 :size=60%')  


**同步传输**: 以数据块为单位，字符与字符之间，字符内部的位与位之间都同步。不需要在每个数据字符中加起始位、校验位、停止位,只需要在数据块之前<font color=green>加一两个同步字符</font>  

> :bulb:串行通信按信息在设备间的<font color=purple>传送方向</font>可分为`单工`、`半双工`和`全双工`  

**单工传输**: 信息始终保持一个固定的方向进行传送  
**半双工传输**: 两个通信设备中的同一时刻只能有一个设备发送数据(<font color=green>即同时只能有一个方向</font>)  
**全双工传输**: 两个通信设备可以同时发送和接受信息  

---
#### 2.接口标准
**RS-232C通信接口**: 串口引脚有`9针`和`25针`两类  
**RS-422A通信接口**: 支持`点对多`的双向通信，<font color=green>即一个主设备同时想多个从设备发送数据</font>  
**RS-485**: RS-422A的变种  

---
#### 3.<font color=red>传输介质(重点)</font> 
![img](img/传输介质的分类.png '图2 传输介质的分类 :size=80%')  

**交叉线和直连线的作用**:  
- >`直连线`: 异种接口  
- >`交叉线`: 同种接口  

:star:**<font color=red>光纤的传输原理</font>**: <font color=green>光的全反射</font>  

### 2.3.3 :数据编码(<font color=red>重点</font>) 
:star:**模拟数据编码**: 用模拟信号的`不同幅度`，`不同频率`，`不同相位` 表达数据的0,1状态  
   - :bulb: 根据载波信号$U(t) = A\sin(\omega + \phi)$中$A,\omega,\phi$的不同表达0,1  
     - >`幅移键控`: 根据幅度的不同表达0,1  
     - >`频移键控`: 根据频率的不同表达0,1  
     - >`相移键控`: 根据相位的不同表达0,1  


:star:**数字信号的数据编码**: 一个clk周期,表示一个数字信号0或1  
   - :star:`不归零编码`: 高电平表示1,低电平表示0  
      - > 信息密度高，不能提取同步信息且有误码积累，只适合极短距离传输  
   - :star:`曼彻斯特编码`: 每个码元都用`两个连续且极性相反`的脉冲表示  
      - >`码元1`: 高电平至低电平的变换  
      - >`码元0`: 低电平至高电平的变换  
   - :star:`差分曼彻斯特编码`: 用码元<font color=red>开始处有无跳变</font>来表示0,1  
      - >`码元1`: 无跳变  
      - >`码元0`: 有跳变  

**数字数据编码**: 用`高低的矩形脉冲信号`表达数据的0,1状态  

---
### 2.3.4 <font color=grey>信道复用技术(不重要）</font> 
频分多路复用  
波分多路复用  
时分多路服用  

---
### 2.3.5 <font color=grey>数据交换技术(不重要)</font> 
**电路交换方式**: 通过网络中的节点在两个站点之间建立专用的通信线路进行数据传输  
- >`优点`: 数据传输迅速，可靠，并能保持原有序列  
- >`缺点`: 通信双方占用通道后，即使不传输数据，其他用户也不能使用  

**报文交换方式**: 将`报文`存入缓冲器，当指定的输出先空闲时，再将数据转发出去  
- >`报文`: 传输单位，长度不限且可变，包括要发送的正文信息和指明收发站的地址及其他控制信息  
- >`优点`: 不需要提前建立一条专用通道;线路利用率高;  
- >`缺点`: 报文大小不一，对存储容量要求较高;出错后整个报文将全部重发;  


**分组交换方式**: 与报文类似，交换单位为报文分组(限制了每个分组的长度)  
- >`报文分组`: 将长的报文分为若干个报文组  

---
### 2.3.6 差错控制
**概念**: 在数据通信过程中发现或纠正差错，并把差错限制在尽可能小的、允许的范围内而采用的技术和方法  

**差错控制方法**:自动重发(ARQ),前向纠错(FEC)  

#### <font color=red>差错控制码(重点)</font>  
**差错控制码**: 奇偶校验码，二维奇偶监督码(方阵码)  

:star:**奇偶校验码**: 通过增加冗余位使得码子中1的个数为奇数或偶数  
- ><font color=green>实例(奇校验):00011100,需要添加1位使得1的个数为奇数</font>  

:star:**二维奇偶监督码**: <font color=red>不仅对水平(行)方向的码元，而且对垂直(列)方向的码元实施奇偶监督</font>  



## 2.4 通信模型(<font color=red>重点</font>)
### 2.4.1 网络拓扑结构与网络控制方法
#### 1.网络拓扑结构
(不重要)**组成**: 节点，链路，通路，端点及转接节点  
- >`节点`: 网络系统中各种数据处理设备  
- >`链路`: 两个节点之间的连接  
- >`通路`: 两个主机从发出信息到收信息节点之间的系列节点和链路  
- >`端点`: 通信的<font color=green>源</font>与<font color=green>宿</font>节点，也叫做访问点  
- >`转接节点`: 通信过程中起控制和转发信息作用的节点  

:star:**分类**:  
- >`星状拓扑结构`: 端用户之间的通信必须经过中心站  
   - >`优点`: 便于系统集中控制，易于维护且网络扩展方便  
   - >`缺点`: 一旦中心系统损坏，整个系统都会瘫痪  
- >`环状拓扑结构`: 每个端用户都与两个相邻的端用户相连;<font color=purple>系统总以单向方式操作</font>  
   - >`优点`: 消除了端用户通信时对中心系统的依赖性  
   - >`缺点`: 某一个节点，一旦失效整个系统都会瘫痪  
- >`总线拓扑结构`: 端用户的物理介质由所有设备共享，哥节点地位平等，无中心节点控制  
   - >`优点`: 连接布线方便，易于扩充，成本低廉，一个节点失效不会影响其他节点  
   - >`缺点`: 要确保端用户发送数据时不会冲突  


#### 2. <font color=grey>网络控制方式(不重要)</font>  
概念: 指在通信网络中使信息从发送装置`迅速而正确`的传递到接受装置的<font color=green>管理机制</font>  

**令牌方式**: 令牌按照<font color=green>设定的顺序</font>沿网络而行,当令牌处于空闲时，节点得到令牌，从而<font color=green>有信息发送权</font>,令牌置为忙，发送完后，令牌充值为空闲，继续沿网络而行 
- >`适合`: 总线网络结构，环状网络结构

**争用方式**: 允许网络中各个节点自由发送信息，当发送冲突时，则停止发送，随机延时一段时间后，重新争用介质  
- >`适合`: 总线网络结构

**主从方式**: 网络中有主站，主站<font color=green>周期性的<u>轮询</u></font>从站节点是否需要通信  
- >`适合`: 形状网络结构，总线主从网络结构

---

### 2.4.2 ISO/OSI参考模型(<font color=red>考有那几层，不需要作用</font>)
ISO/OSI参考模型(开放系统互联参考模型):  将计算机网络的通信过程分为7个层次，每层执行部分通信功能  

>:bulb: ISO/OSI参考模型<font color=red>是一个理论模型</font>，<font color=purple>实际环境中并没有一个真实的网络系统与之完全对应</font>  

**:star:1物理层**: 是必需的,由它完成通信过程(其他层实际并没有进行传输，只是为传送做准备)  
- >负责设备间接受和发送比特流;  
- >在源和目的之间定义有线的、无线的或光的通信规范  
- >建立、管理、释放物理介质连接  
- >实现比特流的透明传输  

**:star:2数据链路层**: 是必需的，建立在物理传输能力的基础上，<font color=green>以帧为单位</font>传输数据  
- > 通过`差错控制`，`流量控制`保证通信线路的可靠  

**3网络层**: 提供逻辑地址和路由选择。确定数据包的<font color=green>传输路径</font>  

**4传输层**: 解决数据在网络之间的<font color=green>传输质量</font>问题,主要涉及网络传输协议  

**5会话层**: 实现两个计算机系统间的连接、建立、维护和管理会话  

**6表示层**: 从应用层获取数据，将其转换为<font color=green>计算机应用层能够读取的格式</font>  

**7应用层**: 与用户直接联系，负责为各类应用进程提供服务  


---
## 2.5<font color=grey>网络互联设备(不重要)</font> 
> 网络互联: 将两个以上的网络系统，通过一定方法联接起来，构成更大规模的网络系统

**中继器**: 工作在物理层,在两个节点的物理层上<font color=green>按位传递信息</font>  
**集线器**: 工作在物理层,对网络进行集中管理的最小单元  
**网络接口卡**: 工作在数据链路层  
**交换机**: 工作在数据链路层  
**网桥(桥接器)**: 工作在数据链路层  
**路由器**: 工作在网络层，在不同网络之间转发数据单元  
**防火墙**  
**网关**: 在传输层或以上层次  


## 2.6 <font color=grey>现场总线控制网络</font>  
**现场总线控制网络**: 用于完成各种`数据采集`和`自动控制任务`的特殊的开放的计算机网络  

**功能**: 将单个分散的、有通信能力的`测控设备`作为网络节点，按照总线、星状、环状等网络拓扑结构连接而成的网络系统  

**任务**：   
- 将控制系统中现场运行的各种信息传送到控制室，<font color=green>是现场设备始终处于远程监视之中</font>  
- 控制室将各种控制、维护、参数修改等命令送往位于生产现场的测量控制设备，<font color=green>使生产现场的设备处于可控状态之中</font>  
- 与操作终端、上层管理网络实现数据传输与信息共享  








