# 数电实验
## 选择器-二位四选一选择器
使用实验给的选择器模板实现的  

## 8-3优先编码器
在always块中使用了for循环来遍历  
当en使能置1时，进入for循环,从低位开始遍历输入x[i],如果x[i] == 1,则另y = i[2:0]  
> 因为高位的在后遍历，这就保证了高位有更高的优先级  

## 四位ALU
主要用case语句来实现ALU的不同运算功能  

## 移位寄存器
用case语句来选择移位寄存器不同的工作方式  

## 状态机及键盘输入  
使用寄存器变量`ps2_clk_sync`记录clk变换信息  
在clk的下降沿时，接受PS2传来的数据  
当接收到全部的八位数据后，将数据输出到终端,通过`$display()`  

# PA1
## cmd_q指令实现原理
通过阅读sdb.c中sdb_mainloop()函数中的代码,可以知道程序会不断的执行指令，知道执行的指令的返回值`<0`时  
由此，我在执行cmd_q()函数时，返回了-1从而实现了退出sdb_mainloop()函数，即退出了nemu  

## cmd_si指令
主要是通过cpu_exec()函数来实现单步执行操作  

我自己写了一个将字符串数字转为整型的函数,从而能将字符串中的数字提取出来  
如果没有参数,则执行函数cpu_exec(1)  
如果有偿数,则执行函数cpu_exec(参数)  

## cpu_exec(-1)中传入-1的目的
因为cpu_exec的参数是无符号数，所以-1代表了该数据类型的最大值，从而表示了执行能够执行的最大次数  

## cmd_info 
### info r打印寄存器值
利用函数isa_reg_display();  
> 该函数的实现: 是通过for循环来遍历所有的寄存器，并打印其值  

### info w
遍历head链表，打印所有的监视点 

## cmd_x 扫描内存
主要是通过nemu/src/memory/paddr.c中的函数`paddr_read()`来读取内存的值  
利用strtok()函数来拆分参数args,提取出`N`和`起始地址`，然后遍历即可  

## cmd_p 表达式求值
添加来表达式的词法分析  

### check_parentheses()的实现
先使用for循环对表达式进行遍历，找到表达式中含有的所有`(`和`)`，并对其计数  
> 在遍历过程中,如果存在右括号大于左括号,则表达式一定错误  
> 遍历完，再判断左右括号数目是否相等

如果只有一对括号，则判断括号是否位于表达式的开头和结尾，如果这样，则表示存在左右括号,返回0  
如果存在多对括号  
> 通过遍历，删除所有相邻的左右括号,即形如`()`  
> 然后如果开头和结尾还有括号，则表示不相邻  
>> 这时拿走左右括号，判断表达式是否错误，如果没问题，则表示存在左右括号  

### 区分解引用和乘法符号  
当`*`在表达式的最前面时或*前面是一个运算符(括号)时，是解引用符号  
负号也是一样的实现  

### 生成表达式代码
就是通过递归调用和生成随机数(决定随机操作符和随机数)  

### 除0行为 
在`eval()`求值函数中，进行除法运算时，利用assert()判断出数是否为0  


## 监视点的实现 
生成监视点,使用new_wp()函数。  
删除监视点，利用free_wp()函数  

###  new_wp()函数的原理
定义了一个全局变量`WP_NUM`用来记录监视点的数目  
通过do-while()找到head链表结构的尾结点，然后将free_空闲监视点链表的头结点添加导head链表中去  
然后将free_指向的下一个结点作为free_链表的头结点  

### free_wp(WP *wp)
1. 找到要释放的监视点在head链表中的位置  
2. 然后令其前面一个结点指向它后面的一个结点  
3. 将wp结点添加到free_的尾结点后  

### 扫描监视点
在nemu/src/cpu/cpu-exec.c中的函数`trace_and_difftest()`函数中添加  

1. 首先先获取到了监视点链表  
2. 利用for循环对监视点链表进行遍历  
   - 监视点包含cur_value和old_value这两个成员  
3. 利用expr()表达式求值函数，对监视点进行求值，并存于cur_value  
4. 与old_value进行对比，如果不同，则输出`触发监视点，并打印新值和旧值`  
5. 令old_value = new_value  
6. 如果触发了监视点，则将nemu_state.state设为`NEMU_STOP`  

### 删除监视点
利用free_wp()函数来实现的  

